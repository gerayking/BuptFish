<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="Dashboard">
    <meta name="keyword" content="Dashboard, Bootstrap, Admin, Template, Theme, Responsive, Fluid, Retina">
    <title>BUPTFISH - Second-hand trading platform</title>
    {% load  static %}
    <!-- Favicons -->
    <link href="{% static 'img/favicon.png' %}" rel="icon">
    <link href="{% static 'img/apple-touch-icon.png' %}" rel="apple-touch-icon">

    <!-- Bootstrap core CSS -->
    <link href="{% static 'lib/bootstrap/css/bootstrap.min.css' %}" rel="stylesheet">
    <!--external css-->
    <link href="{% static 'lib/font-awesome/css/font-awesome.css' %}" rel="stylesheet"/>
    <link href="{% static 'lib/fancybox/jquery.fancybox.css' %}" rel="stylesheet"/>
    <!-- Custom styles for this template -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <link href="{% static 'css/style-responsive.css' %}" rel="stylesheet">
    <script src="{% static 'lib/jquery/jquery.min.js' %}"></script>

    <link rel="stylesheet" href="{% static 'css/carts.css' %}">
    <link rel="stylesheet" href="{% static 'css/reset.css' %}">


</head>

<body>
    <!--header start-->
    <header class="header black-bg">
    <a href="{% url 'user:index' %}" class="logo"><b>BUPT<span>FISH</span></b></a>
    <!--logo end-->
    <div class="nav notify-row" id="top_menu">
        <!--  notification start -->
        <ul class="nav top-menu">

        </ul>
        <!--  notification end -->
    </div>
    <div class="top-menu">
        <ul class="nav pull-right top-menu">
            {% if request.user != None %}
                <li><a class="logout" href="{% url 'user:login' %}">Logout</a></li>
            {% endif %}
        </ul>
    </div>
</header>

    <section id="container">
    <!--header end-->
        <!--sidebar start-->
       <aside>
        <div id="sidebar" class="nav-collapse ">
            <!-- sidebar menu start-->
            <ul class="sidebar-menu" id="nav-accordion">
            <p class="centered"><a href="{% url 'user:userInfo' %}"><img src={{ request.user.avatar }} class="img-circle" width="80"></a>
</p>
                <h5 class="centered">{{ request.user.username }}</h5>

                <li class="sub-menu">
                    <a class="active" href="javascript:;">
                        <span><a href="{% url 'user:index' %}"><h5>用户主页</h5></a></span>
                        <span><a href="{% url 'user:search_goods' %}"><h5>搜索</h5></a></span>
                        <span><a href="{% url 'user:shopping_cart' %}"><h5>购物车</h5></a></span>
                        <span><a href="{% url 'user:collect' %}"><h5>收藏夹</h5></a></span>
                    </a>
                </li>
            </ul>
            <!-- sidebar menu end-->
        </div>
    </aside>
    <!--sidebar end-->
    <!--main content start-->
    <section id="main-content">
      <section class="wrapper site-min-height">
           <div class="container">
        <h1>购物车</h1>
        <section class="cartMain">
	<div class="cartMain_hd">
		<ul class="order_lists cartTop">
			<li class="list_chk">
				<!--所有商品全选-->
				<input type="checkbox" id="all" class="whole_check">
				<label for="all"></label>
				全选
			</li>
			<li class="list_con">商品信息</li>
			<li class="list_info">商品描述</li>
			<li class="list_price">单价</li>
			<li class="list_amount">数量</li>
			<li class="list_sum">金额</li>
			<li class="list_op">操作</li>
		</ul>
	</div>
            <div>
                {% for goods in goodlist %}
	<div class="cartBox">
		<div class="shop_info">
			<div class="all_check">
				<!--店铺全选-->
				<input type="checkbox" id="shop_{{ goods.goods_id }}" class="shopChoice">
				<label for="shop_{{ goods.goods_id }}" class="shop"></label>
			</div>
			<div class="shop_name">
				商家：<a href="javascript:;">{{ goods.user_name }}</a>
			</div>
		</div>
		<div class="order_content">
			<ul class="order_lists" data-id="{{ goods.goods_id }}">
				<li class="list_chk">
					<input type="checkbox" id="checkbox_{{ goods.goods_id }}" class="son_check">
					<label for="checkbox_{{ goods.goods_id }}"></label>
				</li>
				<li class="list_con">
					<div class="list_img"><a href="javascript:;"><img src="{{ goods.picture }}" alt=""></a></div>
					<div class="list_text"><a href="javascript:;">{{ goods.goods_name}}</a></div>
				</li>
				<li class="list_info">
                    {{ goods.description}}
				</li>
				<li class="list_price">
					<p class="price">￥{{ goods.price }}</p>
				</li>
				<li class="list_amount">
					<div class="amount_box">
						<p>{{ goods.goods_num }}</p>
					</div>
				</li>
				<li class="list_sum">
					<p class="sum_price">￥{{ goods.price }}</p>
				</li>
				<li class="list_op">
					<p class="del"><a href="javascript:;" class="delBtn">移除商品</a></p>
				</li>
			</ul>
		</div>
	</div>
                {% endfor %}
                </div>
	<!--底部-->
	<div class="bar-wrapper">
		<div class="bar-right" style="margin-right: 50px;">
			<div class="totalMoney">共计: <strong class="total_text">0.00</strong></div>
			<div class="calBtn"><a href="javascript:;">结算</a></div>
		</div>
	</div>
</section>
<section class="model_bg"></section>
<section class="my_model">
	<p class="title">删除宝贝<span class="closeModel">X</span></p>
	<p>您确认要删除该宝贝吗？</p>
	<div class="opBtn"><a href="javascript:;" class="dialog-sure">确定</a><a href="javascript:;" class="dialog-close">关闭</a></div>
</section>
        <a href="inline_editor.html#" class="go-top">
          <i class="fa fa-angle-up"></i>
          </a>
      </div>
      </section>
    <!--footer end-->
  </section>
    </section>
  <!-- js placed at the end of the document so the pages load faster -->
  <script src="/static/js/jquery.min.js"></script>
  <script src="/static/js/carts.js"></script>
  <script src="/static/lib/jquery/jquery.min.js"></script>
  <script src="/static/lib/bootstrap/js/bootstrap.min.js"></script>
  <script class="include" type="text/javascript" src="/static/lib/jquery.dcjqaccordion.2.7.js"></script>
  <script src="/static/lib/jquery.scrollTo.min.js"></script>
  <script src="/static/lib/jquery.nicescroll.js" type="text/javascript"></script>
  <!--common script for all pages-->
  <script src="/static/lib/common-scripts.js"></script>
  <!--script for this page-->
  <script src="/static/lib/ckeditor/ckeditor.js"></script>

<script>
    var $order_lists = null;
    var $order_content = '';
    $('.delBtn').click(function () {
        $order_lists = $(this).parents('.order_lists');
        $order_content = $order_lists.parents('.order_content');
        $('.model_bg').fadeIn(300);
        $('.my_model').fadeIn(300);
    });

    //关闭模态框
    $('.closeModel').click(function () {
        closeM();
    });
    $('.dialog-close').click(function () {
        closeM();
    });
    function closeM() {
        $('.model_bg').fadeOut(300);
        $('.my_model').fadeOut(300);
    }
    function delShopCart(goodsId){
                    $.ajax({
                        url : '/user/delShopCart/',
                        data:{
                            goodsId : goodsId,
                            userName : '{{ request.user.username }}'
                        },
                        async:'false',
                        type:"POST",
                        success : function (data){
                            data = JSON.parse(data);
                            if(data["msg"]=="True"){
                                alert(data["msg"]);
                            }
                        }
                    });
                    window.location.href='{% url 'user:shopping_cart' %}';
                }
    //确定按钮，移除商品
    $('.dialog-sure').click(function () {
        var id = $order_lists.data("id");
        delShopCart(id);
        $order_lists.remove();
        if($order_content.html().trim() == null || $order_content.html().trim().length == 0){
            $order_content.parents('.cartBox').remove();
        }
        closeM();
        $sonCheckBox = $('.son_check');
        totalMoney();
    })
</script>
</body>

</html>
